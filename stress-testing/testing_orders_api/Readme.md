
### Testing Orders API
- it needs PORT-FORWARDING for the nats service, the command is:
    ```bash
    # in the host
    bash port-forward.sh
    export NATS_URL="nats://localhost:4222" 
    nats str ls
    ```
- Check the db model "ticket" before run the test, it must empty.
- This test create a ticket and updated three times, its goals is to test the performance of the 
API and the correctness of the data because of race conditions and concurrency, some events
with lower version that the current version can arrive first and the API should nack them.

- The perfect result is the db with the last versions of all the events.
- The ids generated by the script must be unique, test the ids uniqueness with the following command:
    ```bash
    sort ids.test.csv | uniq -c | awk '$1 > 1'
    sord ids.test.csv | uniq -d
    ```

**WARNING**: it must be deleted the db before run this test. Orders Api Ticket model is 
the replica of the Ticket model in the Ticket Service, the Ticket Service actually version the 
Ticket Model.

```bash
db_orders=$(kubectl get pods -l db=orders -o jsonpath="{.items[0].metadata.name}")

kubectl exec -it "$db_orders" -- psql -U jorge -d orders -t -c 'SELECT COUNT(*) FROM "ticket" WHERE "version" <> 3;' -q
# 0 rows
kubectl exec -it "$db_orders" -- psql -U jorge -d orders -t -c 'SELECT COUNT(*) FROM "ticket" WHERE "version" = 3;' -q
# n rows 
kubectl exec -it "$db_orders" -- psql -U jorge -d orders -t -c 'DELETE FROM "ticket";' -q
```