name: pull_request

on:
  workflow_dispatch:
concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: ${{ github.ref != 'refs/heads/master' }}

jobs:
  #  datree kustomize test --verbose  k8s/overlay/digitalOcean --policy-config policies.yaml
  k8sPolicyCheck:
    runs-on: ubuntu-latest
    timeout-minutes: 2
    steps:
      - name: checkout
        uses: actions/checkout@v3
      - name: run datree policy check
        uses: datreeio/action-datree@main
        with:
          isKustomize: true
          path: 'k8s/overlay/digitalOcean'
          cliArguments: '--policy-config policies.yaml'
#      - name: docker login
#        env:
#          DOCKER_USER: ${{ secrets.DOCKER_USER }}
#          DOCKER_PASSWORD: ${{ secrets.DOCKER_PASSWORD }}
#        run: |
#          docker login -u $DOCKER_USER -p $DOCKER_PASSWORD
#      - name: build
#        run: |
#          docker build ./c# -t aimvector/csharp:1.0.0
#      - name: push
#        run: |
#          docker push aimvector/csharp:1.0.0
#      - name: deploy
#        run: |
#          echo 'deploying...'
